;/*FB_PKG_DELIM*/

__d("LSExpireNewFriendBump",["LSIssueNewTask","LSOptimisticRemoveThread"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return r[0]=t.i64.or_(t.i64.cast([0,0]),t.i64.cast([256,0])),t.db.table(9).fetch([[[e[0]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?0:(a=l.item,t.i64.eq(t.i64.and_(a.capabilities2,r[0]),r[0])&&t.i64.neq(a.mailboxType,t.i64.cast([0,4096]))?t.sequence([function(r){return t.storedProcedure(n("LSOptimisticRemoveThread"),e[0],t.i64.cast([0,1]))},function(o){return r[1]=new t.Map,r[1].set("thread_key",e[0]),r[2]=t.toJSON(r[1]),t.storedProcedure(n("LSIssueNewTask"),"expire_new_friend_bump",t.i64.cast([0,416]),r[2],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}]):t.resolve())})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxExpireNewFriendBumpStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSAutoExpireNewFriendBump",["LSExpireNewFriendBump"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=new t.Map,r[0].set("thread_key",e[0]),r[1]=t.toJSON(r[0]),t.db.table(2).fetch([[[e[1]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?0:(a=l.item,a.taskValue===r[1]?t.storedProcedure(n("LSExpireNewFriendBump"),e[0]):t.resolve())})},function(n){return t.forEach(t.db.table(2).fetch([[[e[1]]]]),function(e){return e.delete()})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxAutoExpireNewFriendBumpStoredProcedure",e.__tables__=["pending_tasks"],a.exports=e}),null);